## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.3, < 2.0 |
| <a name="requirement_azurerm"></a> [azurerm](#requirement\_azurerm) | >= 4.0 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_azurerm"></a> [azurerm](#provider\_azurerm) | 4.1.0 |
| <a name="provider_random"></a> [random](#provider\_random) | 3.6.2 |

## Modules

| Name | Source | Version |
|------|--------|---------|
| <a name="module_fortigate_scaleset"></a> [fortigate\_scaleset](#module\_fortigate\_scaleset) | ../../modules/fortigate/scaleset | n/a |
| <a name="module_gwlb"></a> [gwlb](#module\_gwlb) | ../../modules/azure/gwlb | n/a |
| <a name="module_standard_load_balancer"></a> [standard\_load\_balancer](#module\_standard\_load\_balancer) | ../../modules/azure/standard_load_balancer | n/a |
| <a name="module_vnet"></a> [vnet](#module\_vnet) | ../../modules/azure/vnet | n/a |

## Resources

| Name | Type |
|------|------|
| [azurerm_resource_group.new_group](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/resource_group) | resource |
| [random_password.psksecret](https://registry.terraform.io/providers/hashicorp/random/latest/docs/resources/password) | resource |
| [random_password.random_fgt_password](https://registry.terraform.io/providers/hashicorp/random/latest/docs/resources/password) | resource |
| [azurerm_resource_group.existing_group](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/resource_group) | data source |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_azure_subscription_id"></a> [azure\_subscription\_id](#input\_azure\_subscription\_id) | The subscription ID associated with your Azure account. For more information, please visit [this Microsoft documentation](https://learn.microsoft.com/en-us/azure/azure-portal/get-subscription-tenant-id). | `string` | n/a | yes |
| <a name="input_fortigate_scaleset"></a> [fortigate\_scaleset](#input\_fortigate\_scaleset) | FortiGate Virtual Machine Scale Set.<br/>Options:<br/>- vmss\_name                                 (Required\|string) The name of the FortiGate Scale Set.<br/>- image\_version                        (Optional\|string) Fortigate version.  The default value is `7.2.8`.<br/>- license\_type                         (Optional\|string) The options are `byol` and `payg`.<br/>- zones                                (Optional\|list(string)) Specifies a list of Availability Zones in which this Linux Virtual Machine Scale Set should be located.<br/>- vnet\_key                             (Required\|string) The VNET hosting the fortigate instances.<br/>- storage\_account\_name                 (Optional\|string) The storage account that is used for the FortiGate Auto Scale set.<br/>- storage\_account\_creation\_flag        (Optional\|bool) Set to true to create a new storage account; set to false to use the existing one specified with `storage_account_name`. Default: true<br/>- application\_insights\_id              (Optional\|string) An ID of the Application Insights instance to use for providing metrics for autoscaling.<br/>- network\_interfaces                   (Required\|list) Network interfaces for the FortiGate instances.<br/>- enable\_accelerated\_networking        (Optional\|boolean) If true, enable Azure accelerated networking (SR-IOV) for all dataplane network interfaces.<br/>- fortigate\_username                   (Required\|string) The default is `fgtadmin`.<br/>- fortigate\_password                   (Required\|string) If the value is not provided, a generated string will be used for the password.<br/>- fortigate\_license\_folder\_path        (Optional\|string) The path for file-type licenses. If provided, the licenses will be uploaded; Otherwise, it assumes a FortiFlex token will be used.<br/>- fortiflex\_api\_username               (Required\|string) The username used to access to your Fortiflex account.<br/>- fortiflex\_api\_password               (Required\|string) The password used to access to your Fortiflex account.<br/>- fortiflex\_config\_id                  (Required\|string) The ID of the configuration for which to retrieve the list of VMs.<br/>- fortiflex\_retrieve\_mode              (Required\|string) mode to specify how fortiflex tokens are used, can be use\_active or use\_stopped, use\_stopped mode will use the fortiflex token with stopped status in your fortiflex account.<br/>- autoscale\_metrics                    (Required\|map) The metrics used to automatically scale in/out FortiGate instances.<br/>- autoscale\_notification\_emails        (Optional\|list) Specifies a list of custom email addresses to which the autoscaling notifications will be sent.<br/>- data\_type                            (Optional\|string) Use custom\_data or user\_data.<br/>- min\_count                            (Optional\|number) The minimum number of instances to maintain in the scale set. The default value is `1`.<br/>- default\_count                        (Optional\|number) The default number of instances to maintain in the scale set.<br/>The default value is `1`.<br/>- max\_count                            (Optional\|number) The maximum number of instances to maintain in the scale set.  The default value is `1`.<br/><br/>Options for autoscale\_metrics:<br/>  metric\_name                   (Required\|string) The autoscale metric name.<br/>  operator                      (Required\|string) Specifies the operator used to compare the metric data and threshold. Possible values are: Equals, NotEquals, GreaterThan, GreaterThanOrEqual, LessThan, LessThanOrEqual.<br/>  statistic                     (Required\|string) Specifies how the metrics from multiple instances are combined. Possible values are Average, Max, Min and Sum.<br/>  threshold                     (Required\|string) Specifies the threshold of the metric that triggers the scale action.<br/>  time\_aggregation              (Required\|string) Specifies how the data that's collected should be combined over time. Possible values include Average, Count, Maximum, Minimum, Last and Total.<br/>  time\_grain\_minutes            (Required\|number) Specifies the granularity of metrics that the rule monitors, which must be one of the pre-defined values returned from the metric definitions for the metric. This value must be between 1 minute and 12 hours.<br/>  time\_window\_minutes           (Required\|number) Specifies the time range for which data is collected, which must be greater than the delay in metric collection (which varies from resource to resource). This value must be between 5 minutes and 12 hours.<br/>  scale\_action\_direction        (Required\|string) The scale direction. Possible values are Increase and Decrease.<br/>  scale\_action\_type             (Required\|string) The type of action that should occur. Possible values are ChangeCount, ExactCount, PercentChangeCount and ServiceAllowedNextValue.<br/>  scale\_action\_value            (Required\|number) The number of instances involved in the scaling action.<br/>  scale\_action\_cooldown\_minutes (Required\|number) The amount of time to wait since the last scaling action before this action occurs. Must be between 1 minute and 1 week.<br/>} | <pre>map(object({<br/>    vmss_name                     = string<br/>    storage_account_name          = optional(string)<br/>    storage_account_creation_flag = optional(bool, true)<br/>    zones                         = optional(list(string))<br/>    vnet_key                      = string<br/>    image_version                 = optional(string, "7.2.8")<br/>    architecture                  = optional(string)<br/>    license_type                  = optional(string)<br/>    application_insights_id       = optional(string)<br/>    network_interfaces = list(object({<br/>      name                = string<br/>      subnet_key          = string<br/>      gateway_ip_address  = string<br/>      create_public_ip    = optional(bool)   # Optional boolean<br/>      enable_backend_pool = optional(bool)   # Optional boolean<br/>      gwlb_key            = optional(string) # Optional string<br/>      gwlb_backend_key    = optional(string) # Optional string<br/>    }))<br/>    enable_accelerated_networking = optional(bool)<br/>    fortigate_username            = optional(string, "fgtadmin")<br/>    fortigate_password            = optional(string)<br/>    fortigate_license_folder_path = optional(string)<br/>    fortiflex_api_username        = string<br/>    fortiflex_api_password        = string<br/>    fortiflex_config_id           = string<br/>    fortiflex_retrieve_mode       = string<br/>    autoscale_metrics = map(object({<br/>      metric_name                   = string<br/>      operator                      = string<br/>      statistic                     = string<br/>      threshold                     = string<br/>      time_aggregation              = string<br/>      time_grain_minutes            = number<br/>      time_window_minutes           = number<br/>      scale_action_direction        = string<br/>      scale_action_type             = string<br/>      scale_action_value            = number<br/>      scale_action_cooldown_minutes = number<br/>    }))<br/>    autoscale_notification_emails = optional(list(string))<br/>    min_count                     = optional(number, 1)<br/>    default_count                 = optional(number, 1)<br/>    max_count                     = optional(number, 1)<br/>  }))</pre> | n/a | yes |
| <a name="input_gateway_load_balancers"></a> [gateway\_load\_balancers](#input\_gateway\_load\_balancers) | Gateway Load Balancer definition.<br/>Options:<br/>- gwlb\_name           - (Required\|string) The name of the Gateway Load Balancer.<br/>- vnet\_key            - (Required\|string) Key of a VNet from `var.vnets` that contains target Subnet for GWLB's frontend. Used to get Subnet\_id with `subnet_key`.<br/>- subnet\_key          - (Required\|string) Key of a Subnet from `var.vnets[vnet_key]`.<br/>- frontend\_ip\_config  - (Optional\|map) Frontned IP configuration as Azure Gateway Load Balancer.<br/>- backend\_pools       - (Optional\|map) Backend configurations as Azure Gateway Load Balancer.<br/>- heatlh\_probe        - (Optional\|map) Health probe configuration as Azure Gateway Load Balancer. | <pre>map(object({<br/>    gwlb_name          = string # Required<br/>    vnet_key           = string # Required<br/>    subnet_key         = string # Required<br/>    frontend_ip_config = optional(map(any))<br/>    backend_pools      = optional(map(any))<br/>    health_probe       = optional(map(any))<br/>  }))</pre> | n/a | yes |
| <a name="input_location"></a> [location](#input\_location) | The Azure Region where the resources exist. | `string` | n/a | yes |
| <a name="input_resource_group_creation_flag"></a> [resource\_group\_creation\_flag](#input\_resource\_group\_creation\_flag) | Set to true to create a new resource group; set to false to use the existing resource group. | `bool` | `true` | no |
| <a name="input_resource_group_name"></a> [resource\_group\_name](#input\_resource\_group\_name) | The name of the Resource Group to be created or used. | `string` | n/a | yes |
| <a name="input_standard_load_balancers"></a> [standard\_load\_balancers](#input\_standard\_load\_balancers) | Standard Load Balancer that is connected with the applications.<br/>Options:<br/>- lb\_name                           - (Required\|string) Name of the Load Balancer resource.<br/>- network\_security\_group\_name       - (Optional\|string) The name of a security group.<br/>- avzones                           - (Optional\|list) For regional Load Balancers, a list of supported zones.<br/>- frontend\_ips                      - (Optional\|map) Map configuring both a listener and load balancing/outbound rules.<br/><br/>  Options for frontend\_ips:<br/>    - create\_public\_ip         - (Optional\|bool) Set to `true` to create a Public IP. Default is `true`<br/>    - public\_ip\_name           - (Optional\|string) The public IP name to be created. Default value is `null`.<br/>    - public\_ip\_resource\_group - (Optional\|string) when using an existing Public IP created in a different Resource Group than the currently used use this property is to provide the name of that RG. Default value is `null`.<br/>    - private\_ip\_address       - (Optional\|string) Specify a static IP address that will be used by a listener Default value is `null`.<br/>    - vnet\_key                 - (Optional\|string) when `private_ip_address is set specifies a vnet_key, as defined in vnet variable. This will be the VNET hosting this Load Balancer. The default value is `null`.<br/>    - subnet_key               - (Optional|string) when `private\_ip\_address is set specifies a subnet's key (as defined in `vnet variable) to which the LB will be attached, in case of FortiGate could be a internal/trust subnet. The default value is `null`.<br/>    - inbound_rules                 - (Optional|map) Same as inbound rules for the Load Balancer.<br/>    - outbound_rules                - (Optional|map) Same as outbound rules for the Load Balancer.<br/>    For more information about the inbound and outbound rules, please visit https://registry.terraform.io/providers/hashicorp/azurerm/3.116.0/docs/resources/lb_rule<br/><br/>Example:<br/>`<pre>"public_lb" = {<br/>  lb_name                           = "public_lb"<br/>  network_security_group_name       = "http_nsg"<br/>  avzones                           = ["1", "2"]<br/>  frontend_ips = {<br/>    "http_webserver" = {<br/>      create_public_ip = true<br/>      inbound_rules = {<br/>        http = {<br/>          enable_floating_ip = false<br/>          port               = 80<br/>          protocol           = "Tcp"<br/>        }<br/>      }<br/>    }<br/>  }<br/>}</pre> | `map(any)` | n/a | yes |
| <a name="input_tags"></a> [tags](#input\_tags) | Tags for the created resources. | `map(string)` | `{}` | no |
| <a name="input_vnets"></a> [vnets](#input\_vnets) | Virtual Network Definition.<br/>Options:<br/>- create\_virtual\_network  - (Optional\|bool) Whether to create a new or use an existing VNet, the default is `true`.<br/>- vnet\_name               - (Required\|string) VNet name used to identify a specific vnet.<br/>- resource\_group\_name     - (Optional\|string) The Resource Group that the vnet belongs to.<br/>- address\_space           - (Optional\|list) A list of CIDRs for a new created VNet.<br/>- create\_subnets          - (Optional\|bool) Whether to create or use the exsiting subnets, the default is `true`.<br/>- subnets                 - (Required\|map) Subnet definition.<br/>- network\_security\_groups - (Optional\|map) NSG used for the vnet.<br/><br/>  Options for network\_security\_groups:<br/>    - name                             - (Required\|string) Network Security Group Name.<br/>    - rules                            - (Optional\|map) Rules for the NSG.<br/><br/>      Options for rules:<br/>      - priority                       - (Required\|number) Specifies the priority of the rule. The value can be between 100 and 4096.<br/>      - direction                      - (Required\|string) The direction specifies if rule will be evaluated on incoming or outgoing traffic. Possible values are `Inbound` and `Outbound`.<br/>      - access                         - (Required\|string) Specifies whether network traffic is allowed or denied. Possible values are `Allow` and `Deny`.<br/>      - protocol                       - (Required\|string) Network protocol this rule applies to. Possible values include Tcp, Udp, Icmp, Esp, Ah or * (which matches all).<br/>      - source\_address\_prefix          - (Optional\|string) CIDR or source IP range or * to match any IP.<br/>      - source\_address\_prefixes        - (Optional\|list)  List of source address prefixes. Tags may not be used. This is required if source\_address\_prefix is not specified.<br/>      - source\_port\_range              - (Optional\|string) Source Port or Range. Integer or range between 0 and 65535 or * to match any. This is required if source\_port\_ranges is not specified.<br/>      - source\_port\_ranges             - (Optional\|list) List of source ports or port ranges. This is required if source\_port\_range is not specified.<br/>      - destination\_address\_prefix     - (Optional\|string) CIDR or destination IP range or * to match any IP.<br/>      - destination\_address\_prefixes   - (Optional\|list) List of destination address prefixes.<br/>      - destination\_port\_range         - (Optional\|string) Destination Port or Range. Integer or range between 0 and 65535 or * to match any. This is required if destination\_port\_ranges is not specified.<br/>      - destination\_port\_ranges        - (Optional\|list) List of destination ports or port ranges. This is required if destination\_port\_range is not specified.<br/><br/>Example:<pre>vnets = {<br/>  security_vnet = {<br/>    vnet_name = "your_vnet_name"<br/>    resource_group_name = "your_resource_group_name"<br/>    address_space = "192.168.1.0/24"<br/>    subnets   = "192.168.1.0/25"<br/>  }<br/>}</pre> | <pre>map(object({<br/>    create_virtual_network = optional(bool, true)<br/>    vnet_name              = string<br/>    resource_group_name    = optional(string)<br/>    address_space          = optional(list(string))<br/>    create_subnets         = optional(bool, true)<br/>    subnets                = map(any)<br/>    network_security_groups = optional(map(object({<br/>      name = string<br/>      rules = map(object({<br/>        priority                     = number<br/>        direction                    = string<br/>        access                       = string<br/>        protocol                     = string<br/>        source_address_prefix        = optional(string)<br/>        source_address_prefixes      = optional(list(string))<br/>        source_port_range            = optional(string)<br/>        source_port_ranges           = optional(list(string))<br/>        destination_address_prefix   = optional(string)<br/>        destination_address_prefixes = optional(list(string))<br/>        destination_port_range       = optional(string)<br/>        destination_port_ranges      = optional(list(string))<br/>      }))<br/>    })), {})<br/>  }))</pre> | n/a | yes |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_fortigate_instances"></a> [fortigate\_instances](#output\_fortigate\_instances) | The fortigate instances in the vmss. |
| <a name="output_gwlb_frontend_ip_configuration_id"></a> [gwlb\_frontend\_ip\_configuration\_id](#output\_gwlb\_frontend\_ip\_configuration\_id) | The Frontend IP Configuration ID of the Gateway SKU Load Balancer. |
| <a name="output_standard_lb_backend_pool_id"></a> [standard\_lb\_backend\_pool\_id](#output\_standard\_lb\_backend\_pool\_id) | The backend ID of the Standard Load Balancer that servers connected with. |
| <a name="output_standard_lb_frontend_ip"></a> [standard\_lb\_frontend\_ip](#output\_standard\_lb\_frontend\_ip) | The IP addresses of the Standard Load Balancer. |
| <a name="output_standard_lb_id"></a> [standard\_lb\_id](#output\_standard\_lb\_id) | Standard Load Balancer ID. |
| <a name="output_vnet"></a> [vnet](#output\_vnet) | n/a |
